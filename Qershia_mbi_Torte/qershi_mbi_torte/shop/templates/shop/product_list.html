{% extends "shop/navbar_footer.html" %}
{% load static %}

{% block content %}
<style>
  .nav-left-custom {
    margin-bottom: 20px;
    text-align: left;
  }
  .nav-left-custom a {
    color: gray;
    text-decoration: none;
    font-weight: 500;
    padding: 6px 12px;
    border-radius: 6px;
    transition: all 0.3s ease;
  }
  .nav-left-custom a:hover {
    background-color: #c98b87;
    color: white;
  }

  .nav-center {
    text-align: center;
    margin-bottom: 20px;
  }
  .nav-center a {
    font-weight: 600;
    color: #575757;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .nav-center a:hover {
    color: #c98b87;
  }

    /* Sortimi */
  .sort-container {
    text-align: right;
    margin: 10px 20px 20px 20px;
  }
  .sort-container label {
    font-weight: 600;
    margin-right: 8px;
  }
  .sort-container select {
    padding: 6px 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    cursor: pointer;
  }
  .sort-container select:focus {
    border-color: #c33;
    outline: none;
  }
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
    justify-content: center;
  }

  .product-card {
    background-color: #f8f5f1;
    border-radius: 20px;
    padding: 20px;
    border: 1px solid #e0d4c7;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: left;
  }

  .product-card img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 15px;
    margin-bottom: 20px;
  }

  .add-to-cart-button {
    background-color: #e0b49f;
    color: #575757;
    border: none;
    padding: 12px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1em;
    font-weight: 600;
    margin-top: 20px;
    width: 100%;
    transition: background-color 0.3s ease;
  }
  .add-to-cart-button:hover {
    background-color: #d1a48c;
  }

  .btn-favorite {
    display: block;
    margin-top: 10px;
    text-align: center;
    color: #e06c75;
    font-weight: 600;
    text-decoration: none;
    transition: color 0.3s;
    cursor: pointer;
    position: relative;
  }
  .btn-favorite i {
    transition: transform 0.3s ease, color 0.3s ease;
  }
  .btn-favorite.active i {
    color: #ff0000;
    transform: scale(1.3);
  }

  /* Efekti i highlight */
.highlight {
  animation: highlightFade 3s ease-out;
  background-color: #fff3cd !important; /* e verdh√´ e leht√´ */
}
@keyframes highlightFade {
  0%   { background-color: #fff3cd; }
  100% { background-color: transparent; }
}
</style>

<!-- Kthehu mbrapsht -->
<div class="nav-left-custom">
  <a href="javascript:history.back()">
    <i class="fa-solid fa-arrow-left"></i> Kthehu mbrapsht
  </a>
</div>

<!-- Link qendror Produktet -->
<div class="nav-center">
  <a href="{% url 'products' %}">
    Produktet ‚Äì üçí Qershi mbi Tort√´
  </a>
</div>

<div class="sort-container">
  <form method="get" action="">
    <label for="sort_by">Rendit sipas:</label>
    <select name="sort_by" id="sort_by" onchange="this.form.submit()">
      <option value="name" {% if request.GET.sort_by == "name" %}selected{% endif %}>A‚ÄìZ</option>
      <option value="-name" {% if request.GET.sort_by == "-name" %}selected{% endif %}>Z‚ÄìA</option>
      <option value="price" {% if request.GET.sort_by == "price" %}selected{% endif %}>√ámimi m√´ i lir√´</option>
      <option value="-price" {% if request.GET.sort_by == "-price" %}selected{% endif %}>√ámimi m√´ i shtrenjt√´</option>
    </select>
  </form>
</div>

{% if messages %}
  <div class="messages">
    {% for message in messages %}
      <p>{{ message }}</p>
    {% endfor %}
  </div>
{% endif %}

<div class="product-grid">
  {% if products %}
    {% for product in products %}
    <div class="product-card" id="product-{{ product.id }}">
        {% if product.image %}
          <img src="{{ product.image.url }}" alt="{{ product.name }}">
        {% else %}
          <img src="{% static 'images/placeholder.png' %}" alt="No image">
        {% endif %}

        <h2>{{ product.name }}</h2>
        <p>{{ product.price }} Lek√´/cop√´</p>

        <!-- Shto n√´ shport√´: submit klasik -->
        <form class="add-to-cart-form" method="post" action="{% url 'add_to_cart' product.id %}">
          {% csrf_token %}
          <button type="submit" class="add-to-cart-button">SHTO N√ã SHPORT√ã</button>
        </form>

        <!-- Shto te Favorites: submit klasik -->
        <form method="post" action="{% url 'toggle_favorite' product.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn-favorite">
            <i class="fa-regular fa-heart"></i> Shto te Favorites
          </button>
        </form>
      </div>
    {% endfor %}
  {% else %}
    <p style="grid-column: 1 / -1; text-align:center; color:#666; font-style:italic;">
      Nuk ka produkte p√´r momentin.
    </p>
  {% endif %}
</div>

<!-- Efekti highlight p√´r produktin n√´se vjen nga URL me hash -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const hash = window.location.hash;
  if (hash) {
    const product = document.querySelector(hash);
    if (product) {
      product.classList.add("highlight");
      setTimeout(() => product.classList.remove("highlight"), 3000);
    }
  }
});
</script>

{% endblock %}